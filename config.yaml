applications:
  whatsapp-bot:
    source:
      root: /
    
    type: nodejs:20
    
    # ‚≠ê ÿ•ÿ∂ÿßŸÅÿ© runtime
    runtime:
      sizing_hints:
        request_memory: 10
    
    web:
      commands:
        start: "node index.js"
      
      upstream:
        socket_family: tcp
        protocol: http
      
      locations:
        "/":
          root: ""
          passthru: true
          allow: false
    
    mounts:
      auth_info:
        source: storage
        source_path: auth_info
      logs:
        source: storage
        source_path: logs
    
    hooks:
      build: |
        set -e
        echo "üì¶ Installing dependencies..."
        npm ci --only=production
        echo "‚úÖ Build complete!"
      
      deploy: |
        set -e
        echo "üöÄ Deploying WhatsApp Bot..."
        echo "‚úÖ Deployment successful!"
      
      post_deploy: |
        echo "üîç Checking bot status..."
        ps aux | grep node || echo "‚ö†Ô∏è Node process not found"
    
    variables:
      env:
        NODE_ENV: production
        PORT: 8080

routes:
  "https://{default}/":
    type: upstream
    upstream: "whatsapp-bot:http"
    cache:
      enabled: false
  
  "https://www.{default}/":
    type: redirect
    to: "https://{default}/"
