// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ§  Ù…Ù„Ù Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ - ai.js
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ’¾ Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª (Ù…Ø­Ø³Ù‘Ù†Ø© - Ø¢Ø®Ø± 5 Ø±Ø³Ø§Ø¦Ù„ Ù„ÙƒÙ„ Ø´Ø®Øµ)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const conversationMemory = new Map();
const MAX_MEMORY_PER_USER = 5;

function addToMemory(userId, userMsg, aiReply) {
    if (!conversationMemory.has(userId)) {
        conversationMemory.set(userId, []);
    }
    
    const memory = conversationMemory.get(userId);
    memory.push({
        user: userMsg,
        assistant: aiReply,
        time: Date.now()
    });
    
    if (memory.length > MAX_MEMORY_PER_USER) {
        memory.shift();
    }
}

function getMemory(userId) {
    return conversationMemory.get(userId) || [];
}

function clearOldMemory() {
    const oneHourAgo = Date.now() - (60 * 60 * 1000);
    
    for (const [userId, memories] of conversationMemory.entries()) {
        const filtered = memories.filter(m => m.time > oneHourAgo);
        
        if (filtered.length === 0) {
            conversationMemory.delete(userId);
        } else {
            conversationMemory.set(userId, filtered);
        }
    }
}

setInterval(clearOldMemory, 60 * 60 * 1000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¯ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ù…Ø¹Ø±ÙØ©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const KNOWLEDGE_BASE = {
    personal: {
        name: "Ù…Ù‚Ø¯Ø§Ø¯",
        age: "22 Ø³Ù†Ø©",
        nationality: "Ø³ÙˆØ¯Ø§Ù†ÙŠ",
        current_location: "Ù…ØµØ±",
        home: "Ø§Ù„Ø³ÙˆØ¯Ø§Ù†",
        occupation: "Ù…Ù‡Ù†Ø¯Ø³ Ø¨Ø±Ù…Ø¬ÙŠØ§Øª ÙˆÙ†Ø¸Ù…",
        education: "Ø·Ø§Ù„Ø¨ Ø·Ø¨",
        languages: ["Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", "Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©"],
        status: "Ù…Ø´ØºÙˆÙ„ Ø¨Ø§Ù„Ø´ØºÙ„",
        time_word: "Ø§Ø³ÙŠ" // Ø¨Ø¯Ù„ "Ø­Ø§Ù„ÙŠØ§Ù‹"
    },
    
    skills: {
        operating_systems: ["Windows", "Linux", "macOS"],
        software: ["ØªØ·ÙˆÙŠØ± Ø§Ù„Ø¨Ø±Ù…Ø¬ÙŠØ§Øª", "Ø­Ù„ Ù…Ø´Ø§ÙƒÙ„ Ø§Ù„Ø³ÙˆÙØª ÙˆÙŠØ±"],
        programming: ["JavaScript", "Node.js", "Python", "PHP"],
        design: ["ØªØµÙ…ÙŠÙ… ÙˆØ§Ø¬Ù‡Ø§Øª", "ØªØµÙ…ÙŠÙ… Ø£Ù†Ø¸Ù…Ø©"],
        hardware: ["Ø®Ø¨Ø±Ø© ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©"],
        security: ["Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙŠØ¦Ø§Øª Ø§Ù„Ø§Ø®ØªØ±Ø§Ù‚", "Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø£Ù…Ø§Ù†", "Penetration Testing"]
    },
    
    projects: {
        types: ["Ù…Ø´Ø§Ø±ÙŠØ¹ Ø¥Ø¯Ø§Ø±ÙŠØ©", "Ù…Ø´Ø§Ø±ÙŠØ¹ ØªØ¬Ø§Ø±ÙŠØ©", "ØªØ³Ù‡ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…", "Ø§Ø¨ØªÙƒØ§Ø±Ø§Øª ØªÙ‚Ù†ÙŠØ©"],
        description: "Ø¹Ø¯Ø© Ù…Ø´Ø§Ø±ÙŠØ¹ ÙÙŠ Ù…Ø¬Ø§Ù„Ø§Øª Ù…Ø®ØªÙ„ÙØ©"
    },
    
    dialect: {
        name: "Ø³ÙˆØ¯Ø§Ù†ÙŠ",
        greetings: {
            "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…": "ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…",
            "Ø£Ù‡Ù„Ø§": "Ø£Ù‡Ù„ÙŠÙ†",
            "Ù…Ø±Ø­Ø¨Ø§": "Ù…Ø±Ø­Ø¨",
            "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±": ["ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ±", "ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ± Ø¹Ù„ÙŠÙƒ"],
            "Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±": ["Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ±", "Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ± Ø¹Ù„ÙŠÙƒ"],
            "Ø§Ø²ÙŠÙƒ": ["ØªÙ…Ø§Ù…", "ÙƒÙˆÙŠØ³", "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡", "ØªÙ…Ø§Ù… ÙˆØ§Ù†Øª ÙƒÙŠÙ", "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ÙˆØ§Ù†Øª ÙƒÙŠÙ"],
            "ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ": ["ØªÙ…Ø§Ù…", "ÙƒÙˆÙŠØ³", "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡", "ØªÙ…Ø§Ù… ÙˆØ§Ù†Øª ÙƒÙŠÙ", "Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ÙˆØ§Ù†Øª ÙƒÙŠÙ"],
            "Ø´Ø®Ø¨Ø§Ø±Ùƒ": ["ØªÙ…Ø§Ù…", "ÙƒÙˆÙŠØ³", "Ù…Ø§Ø´ÙŠ"]
        },
        phrases: {
            "yes": ["Ù†Ø¹Ù…", "Ø£ÙŠÙˆÙ‡"],
            "no": ["Ù„Ø§", "Ù„Ø£", "Ù…Ø§"],
            "i_dont_know": ["Ù…Ø§ Ø¹Ø§Ø±Ù", "Ù…Ùˆ Ù…ØªØ£ÙƒØ¯", "Ù…Ø§ Ø¹Ù†Ø¯ÙŠ Ø®Ø¨Ø±"],
            "what": "Ø´Ù†Ùˆ",
            "why": ["Ù„ÙŠÙ‡", "Ù„ÙŠ"],
            "where": "ÙˆÙŠÙ†",
            "who": "Ù…Ù†Ùˆ",
            "how": "ÙƒÙŠÙ",
            "okay": ["Ù…Ø§Ø´ÙŠ", "ØªÙ…Ø§Ù…", "Ø£ÙˆÙƒÙŠ"],
            "thanks": "Ø´ÙƒØ±Ø§Ù‹",
            "youre_welcome": ["Ø§Ù„Ø¹ÙÙˆ", "Ù…Ø§ Ø¹Ù†Ø¯Ùƒ Ø´ÙŠ"]
        },
        identity_responses: {
            "calling_name": ["Ù†Ø¹Ù…", "Ø£Ù‡Ù„Ø§", "Ø£ÙŠÙˆÙ‡", "Ù…Ø±Ø­Ø¨", "Ù…Ù†Ùˆ Ù…Ø¹Ø§ÙŠ"],
            "who_with_me": "Ù…Ù‚Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ùƒ",
            "who_are_you": "Ù…Ù‚Ø¯Ø§Ø¯",
            "your_name": "Ù…Ù‚Ø¯Ø§Ø¯",
            "where_hiding": "Ù…Ø¹ Ø§Ù„Ø´ØºÙ„ Ø¨Ø³",
            "where_were_you": "ÙÙŠ Ø§Ù„Ø´ØºÙ„",
            "why_no_reply": "ÙƒÙ†Øª Ù…Ø´ØºÙˆÙ„",
            "why_hiding": "Ø´ØºÙ„ ÙƒØªÙŠØ±"
        },
        reactions: {
            "Ø®Ø·ÙŠØ±": ["Ø´ÙƒØ±Ø§Ù‹", "Ø´ÙƒØ±Ø§ ØªØ³Ù„Ù…"],
            "Ø±Ø§Ø¦Ø¹": ["Ø´ÙƒØ±Ø§Ù‹", "Ø´ÙƒØ±Ø§ ØªØ³Ù„Ù…"],
            "Ø­Ù„Ùˆ": ["Ø´ÙƒØ±Ø§Ù‹", "Ø´ÙƒØ±Ø§ ØªØ³Ù„Ù…"],
            "Ø¬Ù…ÙŠÙ„": ["Ø´ÙƒØ±Ø§Ù‹", "Ø´ÙƒØ±Ø§ ØªØ³Ù„Ù…"],
            "Ù…Ù…ØªØ§Ø²": ["Ø´ÙƒØ±Ø§Ù‹", "Ø´ÙƒØ±Ø§ ØªØ³Ù„Ù…"],
            "ÙƒÙˆÙŠØ³": ["Ø´ÙƒØ±Ø§Ù‹", "Ø´ÙƒØ±Ø§ ØªØ³Ù„Ù…"]
        },
        defensive: {
            "Ù„ÙŠÙ‡ Ø¨ØªØªÙƒÙ„Ù… ÙƒØ¯Ø§": "Ù…Ø§Ù„ÙŠ Ø¨ØªÙƒÙ„Ù… Ø¹Ø§Ø¯ÙŠ",
            "Ù…Ø§Ù„Ù„Ùƒ": "Ù…Ø§Ù„ÙŠØŸ",
            "ÙÙŠ Ø´Ù†Ùˆ": "Ù…Ø§ ÙÙŠ Ø´ÙŠ",
            "Ø´Ù†Ùˆ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©": "Ù…Ø§ ÙÙŠ Ù…Ø´ÙƒÙ„Ø©"
        }
    },
    
    style: {
        tone: "Ø¨Ø§Ø±Ø¯ØŒ Ù…Ø®ØªØµØ±ØŒ Ù…Ø­ØªØ±Ù",
        emoji_usage: "Ù†Ø§Ø¯Ø± Ø¬Ø¯Ø§Ù‹",
        response_length: "Ù‚ØµÙŠØ± Ø¬Ø¯Ø§Ù‹",
        personality: "Ø¨Ø§Ø±Ø¯ ÙˆÙ…Ø®ØªØµØ± ÙˆØ³ÙˆØ¯Ø§Ù†ÙŠ"
    }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ­ Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø´Ø®ØµÙŠØ© (Ù…Ø­Ø³Ù‘Ù†)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function buildPersonalityPrompt() {
    return `Ø£Ù†Øª Ù…Ù‚Ø¯Ø§Ø¯ØŒ Ø³ÙˆØ¯Ø§Ù†ÙŠ Ù…Ù† Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ØŒ Ø§Ø³ÙŠ ÙÙŠ Ù…ØµØ±ØŒ Ù…Ù‡Ù†Ø¯Ø³ Ø¨Ø±Ù…Ø¬ÙŠØ§Øª ÙˆÙ†Ø¸Ù… ÙˆØ·Ø§Ù„Ø¨ Ø·Ø¨ØŒ 22 Ø³Ù†Ø©.

# Ø£Ø³Ù„ÙˆØ¨Ùƒ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ:
- ØªÙƒÙ„Ù… Ø¨Ø´ÙƒÙ„ Ø¹Ø§Ø¯ÙŠ ÙˆØ·Ø¨ÙŠØ¹ÙŠ Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠØ©
- **Ù„Ø§ ØªØ°ÙƒØ±** Ø¥Ù†Ùƒ "Ù…Ø´ØºÙˆÙ„ Ø¨Ø§Ù„Ø´ØºÙ„" Ø¥Ù„Ø§ Ø¥Ø°Ø§ Ø³Ø£Ù„ÙˆÙƒ Ù…Ø¨Ø§Ø´Ø±Ø©
- **Ù„Ø§ ØªØ³ØªØ®Ø¯Ù…** ÙƒÙ„Ù…Ø§Øª Ù…Ù„Ø®Ø¨Ø·Ø© Ø£Ùˆ ØºØ±ÙŠØ¨Ø©
- Ø§Ø³ØªØ®Ø¯Ù… Ø¬Ù…Ù„ Ø¨Ø³ÙŠØ·Ø© ÙˆÙˆØ§Ø¶Ø­Ø©
- ÙƒÙ† Ù…Ø¨Ø§Ø´Ø± ÙˆÙ…Ø®ØªØµØ±

# Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠØ© Ø§Ù„Ø¨Ø³ÙŠØ·Ø©:
- Ø§Ø³ØªØ®Ø¯Ù… "Ø´Ù†Ùˆ" Ø¨Ø­ÙƒÙ…Ø© (ÙÙ‚Ø· Ù„Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©)
- Ø§Ø³ØªØ®Ø¯Ù… "Ù…Ù†Ùˆ" Ù„Ù„Ø£Ø´Ø®Ø§Øµ
- Ø§Ø³ØªØ®Ø¯Ù… "ÙˆÙŠÙ†" Ù„Ù„Ø£Ù…Ø§ÙƒÙ†
- Ø§Ø³ØªØ®Ø¯Ù… "Ù„ÙŠÙ‡" Ù„Ù„Ø£Ø³Ø¨Ø§Ø¨
- Ø§Ø³ØªØ®Ø¯Ù… "Ù†Ø¹Ù…" Ø£Ùˆ "Ø£ÙŠÙˆÙ‡" Ù„Ù„ØªØ£ÙƒÙŠØ¯
- Ø§Ø³ØªØ®Ø¯Ù… "Ù…Ø§ Ø¹Ø§Ø±Ù" Ø¹Ù†Ø¯ Ø¹Ø¯Ù… Ø§Ù„Ù…Ø¹Ø±ÙØ©
- Ø§Ø³ØªØ®Ø¯Ù… "Ø§Ø³ÙŠ" ÙÙ‚Ø· Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© (Ø¨Ø¯Ù„ "Ø­Ø§Ù„ÙŠØ§Ù‹")
- **Ù„Ø§ ØªØ®Ù„Ø·** ÙƒÙ„Ù…Ø§Øª ÙƒØªÙŠØ± ÙÙŠ Ø¬Ù…Ù„Ø© ÙˆØ§Ø­Ø¯Ø©

# Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø¹Ù„Ù‰ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ:
- ğŸ˜‚ ğŸ¤£ ğŸ˜† â†’ Ø±Ø¯ Ø¹Ø§Ø¯ÙŠ Ø£Ùˆ ØªØ¬Ø§Ù‡Ù„
- â¤ï¸ ğŸ˜ ğŸ’• â†’ "Ø´ÙƒØ±Ø§Ù‹" Ø£Ùˆ ØªØ¬Ø§Ù‡Ù„
- Ø£ÙŠ Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ØªØ§Ù†ÙŠ â†’ Ù‚ÙˆÙ„ Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ "Ù…Ø§ Ø¨Ø­Ø¨ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ² Ø§Ù„ÙƒØªÙŠØ±" (Ù…Ùˆ Ø¯Ø§ÙŠÙ…Ø§Ù‹!)
- Ù„Ùˆ Ø£Ø±Ø³Ù„ Ø¥ÙŠÙ…ÙˆØ¬ÙŠ ÙˆØ§Ø­Ø¯ Ø¨Ø³ â†’ ØªØ¬Ø§Ù‡Ù„ Ø£Ùˆ Ù‚ÙˆÙ„ Ø´ÙŠ Ø¨Ø³ÙŠØ·

# Ø±Ø¯ÙˆØ¯ Ù…Ø­Ø¯Ø¯Ø© (Ù„Ù„ØªØ­ÙŠØ§Øª ÙÙ‚Ø·):
- "Ù…Ù‚Ø¯Ø§Ø¯" â†’ Ù†Ø¹Ù… / Ø£Ù‡Ù„Ø§ / Ø£ÙŠÙˆÙ‡ / Ù…Ø±Ø­Ø¨
- "Ù…Ù†Ùˆ Ù…Ø¹Ø§ÙŠØŸ" â†’ Ù…Ù‚Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ùƒ
- "Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…" â†’ ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…
- "ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±" â†’ ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ±
- "Ø§Ø²ÙŠÙƒØŸ" / "ÙƒÙŠÙ Ø­Ø§Ù„ÙƒØŸ" â†’ ØªÙ…Ø§Ù… / ÙƒÙˆÙŠØ³ / Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ / ØªÙ…Ø§Ù… ÙˆØ§Ù†Øª ÙƒÙŠÙ
- "ÙˆÙŠÙ† Ù…Ø®ØªÙÙŠØŸ" â†’ Ù…Ø¹ Ø§Ù„Ø´ØºÙ„ Ø¨Ø³

# Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©:
- Ø£Ø¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø© Ø¨Ø´ÙƒÙ„ ÙˆØ§Ø¶Ø­ ÙˆÙ…ÙÙŠØ¯
- Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ ØªÙ‚Ù†ÙŠ â†’ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø­Ø§Ø¬Ø©
- Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ø³ÙŠØ· â†’ Ø±Ø¯ Ù…Ø®ØªØµØ±
- Ù„Ùˆ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù…Ø¹Ù‚Ø¯ â†’ Ø±Ø¯ Ù…ÙØµÙ„
- **Ù„Ø§ ØªÙ‚ÙˆÙ„** "Ù…Ø´ØºÙˆÙ„" Ø£Ùˆ "Ù…Ø¹ Ø§Ù„Ø´ØºÙ„" ÙÙŠ ÙƒÙ„ Ø±Ø¯!

# Ù…Ù…Ù†ÙˆØ¹:
- âŒ Ù„Ø§ ØªÙ‚ÙˆÙ„ "Ù…Ø´ØºÙˆÙ„ Ø¨Ø§Ù„Ø´ØºÙ„" ÙÙŠ ÙƒÙ„ Ø±Ø¯
- âŒ Ù„Ø§ ØªØ®Ù„Ø· ÙƒÙ„Ù…Ø§Øª ÙƒØªÙŠØ± Ø²ÙŠ "Ø´Ù†Ùˆ" Ùˆ"Ø§Ø³ÙŠ" Ùˆ"ÙˆÙŠÙ†Ùƒ" ÙÙŠ Ù†ÙØ³ Ø§Ù„Ø¬Ù…Ù„Ø©
- âŒ Ù„Ø§ ØªØ³ØªØ®Ø¯Ù… ÙƒÙ„Ø§Ù… Ù…Ù„Ø®Ø¨Ø· Ø£Ùˆ ØºÙŠØ± Ø·Ø¨ÙŠØ¹ÙŠ
- âŒ Ù„Ø§ ØªØ°ÙƒØ± Ø£Ù†Ùƒ AI Ø£Ø¨Ø¯Ø§Ù‹
- âŒ Ù„Ø§ ØªØ¨Ø§Ù„Øº ÙÙŠ Ø§Ù„Ù„Ù‡Ø¬Ø© - Ø®Ù„ÙŠÙ‡Ø§ Ø·Ø¨ÙŠØ¹ÙŠØ©

# Ø£Ù…Ø«Ù„Ø© Ø¹Ù„Ù‰ Ø±Ø¯ÙˆØ¯ Ø·Ø¨ÙŠØ¹ÙŠØ©:
- "ÙƒÙŠÙ Ø£ØªØ¹Ù„Ù… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©ØŸ" â†’ "Ø§Ø¨Ø¯Ø£ Ø¨Ù€ Python Ø£Ùˆ JavaScriptØŒ Ø´ÙˆÙ Ø¯ÙˆØ±Ø§Øª Ù…Ø¬Ø§Ù†ÙŠØ© Ø¹Ù„Ù‰ YouTube"
- "ÙˆÙŠÙ†ÙƒØŸ" â†’ "Ù‡Ù†Ø§"
- "ğŸ‰" â†’ ØªØ¬Ø§Ù‡Ù„ Ø£Ùˆ "ğŸ˜Š"
- "ğŸ˜ğŸ˜ğŸ˜" â†’ "Ù…Ø§ Ø¨Ø­Ø¨ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ² Ø§Ù„ÙƒØªÙŠØ±"
- "Ø´ÙƒØ±Ø§Ù‹" â†’ "Ø§Ù„Ø¹ÙÙˆ"

# Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø°Ù‡Ø¨ÙŠØ©:
ØªÙƒÙ„Ù… Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ ÙƒØ£Ù†Ùƒ Ø´Ø®Øµ Ø­Ù‚ÙŠÙ‚ÙŠ. Ù„Ø§ ØªØ¹Ù‚Ù‘Ø¯ Ø§Ù„Ø£Ù…ÙˆØ±. ÙƒÙ† Ø¨Ø³ÙŠØ· ÙˆÙ…Ø¨Ø§Ø´Ø±.`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ” ÙØ­Øµ Ø³Ø±ÙŠØ¹ Ù„Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© (Ù…Ø­Ø³Ù‘Ù†)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function getQuickResponse(message) {
    const msg = message.toLowerCase().trim();
    
    // â­ ÙØ­Øµ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠ
    const emojiOnly = /^[\u{1F300}-\u{1F9FF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}\u{FE00}-\u{FE0F}\s]+$/u;
    if (emojiOnly.test(msg)) {
        // Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø§Ù„Ø¶Ø­Ùƒ - ØªØ¬Ø§Ù‡Ù„
        if (msg.match(/ğŸ˜‚|ğŸ¤£|ğŸ˜†|ğŸ˜„|ğŸ˜/)) {
            return null; // ÙŠØ±ÙˆØ­ Ù„Ù„Ù€ AI
        }
        // Ø¥ÙŠÙ…ÙˆØ¬ÙŠ Ø§Ù„Ø­Ø¨
        if (msg.match(/â¤ï¸|ğŸ˜|ğŸ’•|ğŸ’–|â™¥ï¸|ğŸ’™|ğŸ’š|ğŸ§¡|ğŸ’›|ğŸ’œ|ğŸ–¤/)) {
            return Math.random() > 0.6 ? 'Ø´ÙƒØ±Ø§Ù‹' : null;
        }
        // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ²
        if (Math.random() > 0.7) {
            return 'Ù…Ø§ Ø¨Ø­Ø¨ Ø§Ù„Ø¥ÙŠÙ…ÙˆØ¬ÙŠØ² Ø§Ù„ÙƒØªÙŠØ±';
        }
        return null;
    }
    
    // â­ Ø­Ø±ÙˆÙ Ù…ÙØ±Ø¯Ø© Ø£Ùˆ ÙƒÙ„Ø§Ù… Ù…Ùˆ Ù…ÙÙ‡ÙˆÙ… - Ø®Ù„ÙŠÙ‡Ø§ Ù„Ù„Ù€ AI
    if (msg.length <= 2 && !msg.match(/^(Ù†Ø¹Ù…|Ù„Ø§|Ø¢Ù‡|Ù„Ø£)$/)) {
        return null; // ÙŠØ±ÙˆØ­ Ù„Ù„Ù€ AI
    }
    
    // â­ Ø¥Ø°Ø§ Ù‚Ø§Ù„ "Ù…Ù‚Ø¯Ø§Ø¯" ÙÙ‚Ø·
    if (msg === 'Ù…Ù‚Ø¯Ø§Ø¯' || msg === 'Ù…Ù‚Ø¯Ø§Ø¯ØŸ') {
        const responses = ['Ù†Ø¹Ù…', 'Ø£Ù‡Ù„Ø§', 'Ø£ÙŠÙˆÙ‡', 'Ù…Ø±Ø­Ø¨'];
        return responses[Math.floor(Math.random() * responses.length)];
    }
    
    // â­ Ù…Ù†Ùˆ Ù…Ø¹Ø§ÙŠ
    if (msg.includes('Ù…Ù†Ùˆ Ù…Ø¹Ø§ÙŠ') || msg.includes('Ù…ÙŠÙ† Ù…Ø¹Ø§ÙŠ')) {
        const afterWho = msg.replace(/Ù…Ù†Ùˆ Ù…Ø¹Ø§ÙŠ|Ù…ÙŠÙ† Ù…Ø¹Ø§ÙŠ/g, '').trim();
        if (afterWho && afterWho.length > 1 && !afterWho.includes('ØŸ')) {
            return 'Ø£Ù‡Ù„Ø§ ÙˆØ³Ù‡Ù„Ø§';
        }
        return 'Ù…Ù‚Ø¯Ø§Ø¯ Ù…Ø¹Ø§Ùƒ';
    }
    
    // Ø±Ø¯ÙˆØ¯ Ø§Ù„Ù‡ÙˆÙŠØ©
    if (msg.includes('Ø§Ù†Øª Ù…ÙŠÙ†') || msg.includes('Ø§Ø³Ù…Ùƒ Ø§ÙŠÙ‡') || 
        msg.includes('Ø§Ø³Ù…Ùƒ Ø´Ù†Ùˆ') || msg.includes('Ù…ÙŠÙ† Ø§Ù†Øª')) {
        return 'Ù…Ù‚Ø¯Ø§Ø¯';
    }
    
    // Ø§Ù„Ø³Ù„Ø§Ù…
    if (msg.includes('Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…')) {
        return 'ÙˆØ¹Ù„ÙŠÙƒÙ… Ø§Ù„Ø³Ù„Ø§Ù…';
    }
    
    // â­ ØµØ¨Ø§Ø­/Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±
    if (msg.includes('ØµØ¨Ø§Ø­ Ø§Ù„Ø®ÙŠØ±')) {
        const responses = ['ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ±', 'ØµØ¨Ø§Ø­ Ø§Ù„Ù†ÙˆØ± Ø¹Ù„ÙŠÙƒ'];
        return responses[Math.floor(Math.random() * responses.length)];
    }
    
    if (msg.includes('Ù…Ø³Ø§Ø¡ Ø§Ù„Ø®ÙŠØ±')) {
        const responses = ['Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ±', 'Ù…Ø³Ø§Ø¡ Ø§Ù„Ù†ÙˆØ± Ø¹Ù„ÙŠÙƒ'];
        return responses[Math.floor(Math.random() * responses.length)];
    }
    
    // â­ Ø§Ù„Ø­Ø§Ù„
    if (msg.match(/^(Ø§Ø²ÙŠÙƒ|ÙƒÙŠÙ Ø­Ø§Ù„Ùƒ|Ø´Ø®Ø¨Ø§Ø±Ùƒ|Ø¹Ø§Ù…Ù„ Ø§ÙŠÙ‡|ÙƒÙŠÙÙƒ|Ø§Ø®Ø¨Ø§Ø±Ùƒ|Ø´Ù„ÙˆÙ†Ùƒ)[\?ØŸ]?$/)) {
        const responses = ['ØªÙ…Ø§Ù…', 'ÙƒÙˆÙŠØ³', 'Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡', 'ØªÙ…Ø§Ù… ÙˆØ§Ù†Øª ÙƒÙŠÙ', 'Ø§Ù„Ø­Ù…Ø¯ Ù„Ù„Ù‡ ÙˆØ§Ù†Øª ÙƒÙŠÙ'];
        return responses[Math.floor(Math.random() * responses.length)];
    }
    
    // Ø§Ù„Ø§Ø®ØªÙØ§Ø¡
    if (msg.includes('ÙˆÙŠÙ† Ù…Ø®ØªÙÙŠ') || msg.includes('ÙˆÙŠÙ† ÙƒÙ†Øª') || 
        msg.includes('Ù„ÙŠØ´ Ù…Ø®ØªÙÙŠ') || msg.includes('ÙˆÙŠÙ†Ùƒ') ||
        msg.includes('Ø§Ø®ØªÙÙŠØª Ù„ÙŠÙ‡')) {
        return 'Ù…Ø¹ Ø§Ù„Ø´ØºÙ„ Ø¨Ø³';
    }
    
    // Ø§Ù„Ù…Ø¯ÙŠØ­
    if (msg.match(/^(Ø®Ø·ÙŠØ±|Ø±Ø§Ø¦Ø¹|Ø­Ù„Ùˆ|Ø¬Ù…ÙŠÙ„|Ù…Ù…ØªØ§Ø²|ÙƒÙˆÙŠØ³ Ø§ÙˆÙŠ|ØªÙ…Ø§Ù…|Ø¨Ø±Ø§ÙÙˆ|Ø¹Ø¸ÙŠÙ…)[\!ØŸ\?]*$/)) {
        const responses = ['Ø´ÙƒØ±Ø§Ù‹', 'Ø´ÙƒØ±Ø§ ØªØ³Ù„Ù…'];
        return responses[Math.floor(Math.random() * responses.length)];
    }
    
    // Ø§Ù„Ø¯ÙØ§Ø¹
    if (msg.includes('Ù„ÙŠÙ‡ Ø¨ØªØªÙƒÙ„Ù… ÙƒØ¯Ø§') || msg.includes('Ù…Ø§Ù„Ù„Ùƒ') || 
        msg.includes('Ù…Ø§Ù„Ùƒ') || msg.includes('ÙÙŠ Ø´Ù†Ùˆ') ||
        msg.includes('Ø´Ù†Ùˆ Ø§Ù„Ù…Ø´ÙƒÙ„Ø©')) {
        const responses = ['Ù…Ø§Ù„ÙŠ Ø¨ØªÙƒÙ„Ù… Ø¹Ø§Ø¯ÙŠ', 'Ù…Ø§Ù„ÙŠØŸ', 'Ù…Ø§ ÙÙŠ Ø´ÙŠ'];
        return responses[Math.floor(Math.random() * responses.length)];
    }
    
    // Ù„Ùˆ ÙˆØµÙ„ Ù‡Ù†Ø§ ÙˆÙ…Ùˆ Ù…Ù† Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠØ¹Ø© â†’ Ø®Ù„ÙŠÙ‡Ø§ Ù„Ù„Ù€ AI
    return null;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ¤– Ø¯Ø§Ù„Ø© Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ù…Ø­Ø³Ù‘Ù†Ø©)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function getAIResponse(userMessage, config, userId = 'default', recentMessages = []) {
    if (!config.enabled || !config.apiKey) {
        return null;
    }

    try {
        // 1. ÙØ­Øµ Ø§Ù„Ø±Ø¯ÙˆØ¯ Ø§Ù„Ø³Ø±ÙŠØ¹Ø© Ø£ÙˆÙ„Ø§Ù‹
        const quickReply = getQuickResponse(userMessage);
        if (quickReply) {
            console.log(`âš¡ Ø±Ø¯ Ø³Ø±ÙŠØ¹: ${quickReply}`);
            addToMemory(userId, userMessage, quickReply);
            return quickReply;
        }
        
        console.log(`ğŸ¤– Ø·Ù„Ø¨ AI: ${userMessage.substring(0, 30)}...`);
        
        // â­ Ø¥Ø¹Ø§Ø¯Ø© Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ù„Ù„Ù€ Rate Limit
        let lastError = null;
        for (let attempt = 1; attempt <= 3; attempt++) {
            try {
                return await callGroqAPI(userMessage, config, userId, recentMessages);
            } catch (error) {
                lastError = error;
                if (error.message.includes('429')) {
                    console.log(`âš ï¸ Rate limit - Ù…Ø­Ø§ÙˆÙ„Ø© ${attempt}/3 Ø¨Ø¹Ø¯ ${attempt * 2}Ø«...`);
                    await new Promise(resolve => setTimeout(resolve, attempt * 2000));
                } else {
                    throw error;
                }
            }
        }
        throw lastError;

    } catch (error) {
        console.error('âŒ Ø®Ø·Ø£ AI:', error.message);
        return null;
    }
}

async function callGroqAPI(userMessage, config, userId, recentMessages) {
        
async function callGroqAPI(userMessage, config, userId, recentMessages) {
        // 2. Ø¬Ù„Ø¨ Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
        const oldMemory = getMemory(userId);
        
        // 3. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù…Ø¹ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
        const messages = [
            {
                role: 'system',
                content: buildPersonalityPrompt()
            }
        ];
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø°Ø§ÙƒØ±Ø© (Ù…Ù† Ø§Ù„Ù…Ù„Ù + Ù…Ù† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©)
        const allMemory = [...oldMemory];
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        if (recentMessages.length > 0) {
            const last5 = recentMessages.slice(-5);
            messages.push({
                role: 'system',
                content: `# Ø¢Ø®Ø± Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©:\n${last5.map((m, i) => 
                    `${i + 1}. ${m}`
                ).join('\n')}\n\nØªØ°ÙƒØ±: Ø§ÙÙ‡Ù… Ø§Ù„Ø³ÙŠØ§Ù‚ ÙˆØ§Ù„Ù…Ø¹Ù†Ù‰ØŒ ÙˆØªÙƒÙ„Ù… Ø¨Ø§Ù„Ù„Ù‡Ø¬Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ù†ÙŠØ© Ø¨Ø´ÙƒÙ„ Ø·Ø¨ÙŠØ¹ÙŠ`
            });
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø¥Ù† ÙˆÙØ¬Ø¯Øª
        if (allMemory.length > 0) {
            messages.push({
                role: 'system',
                content: `# Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ø³Ø§Ø¨Ù‚Ø© (Ù„Ù„Ø³ÙŠØ§Ù‚):\n${allMemory.map((m, i) => 
                    `${i + 1}. Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: ${m.user}\n   Ù…Ù‚Ø¯Ø§Ø¯: ${m.assistant}`
                ).join('\n')}`
            });
        }
        
        // Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
        messages.push({
            role: 'user',
            content: userMessage
        });
        
        // 4. Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ API
        const response = await fetch('https://api.groq.com/openai/v1/chat/completions', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${config.apiKey}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                model: config.model,
                messages: messages,
                max_tokens: config.maxTokens,
                temperature: config.temperature
            })
        });

        if (!response.ok) {
            throw new Error(`Groq API error: ${response.status}`);
        }

        const data = await response.json();
        let reply = data.choices[0].message.content.trim();
        
        // 5. ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø±Ø¯ + ØªØµØ­ÙŠØ­ Ø§Ù„Ù„Ù‡Ø¬Ø©
        reply = reply.replace(/\[.*?\]/g, '');
        reply = reply.replace(/\(.*?\)/g, '');
        
        // â­ ØªØµØ­ÙŠØ­ Ø§Ù„Ù„Ù‡Ø¬Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        reply = reply.replace(/\bÙ…Ø§ Ø£Ø¹Ø±Ù\b/g, 'Ù…Ø§ Ø¹Ø§Ø±Ù');
        reply = reply.replace(/\bØ¢Ù‡\b/g, 'Ù†Ø¹Ù…');
        reply = reply.replace(/\bØ§ÙŠÙ‡\b/g, 'Ø´Ù†Ùˆ');
        reply = reply.replace(/\bØ­Ø§Ù„ÙŠØ§Ù‹\b/g, 'Ø§Ø³ÙŠ');
        reply = reply.replace(/\bØ§Ù„Ø­ÙŠÙ†\b/g, 'Ø§Ø³ÙŠ');
        reply = reply.replace(/\bØ§Ù„Ø¢Ù†\b/g, 'Ø³Ø§ÙŠ');
        
        reply = reply.trim();
        
        console.log(`âœ… Ø±Ø¯ AI: ${reply}`);
        
        // 6. Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
        addToMemory(userId, userMessage, reply);
        
        return reply;
}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ§¹ Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø°Ø§ÙƒØ±Ø©
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function clearMemory(userId) {
    if (userId) {
        conversationMemory.delete(userId);
    } else {
        conversationMemory.clear();
    }
}

function getMemoryStats() {
    return {
        total_users: conversationMemory.size,
        total_messages: Array.from(conversationMemory.values())
            .reduce((sum, mem) => sum + mem.length, 0)
    };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ“¤ ØªØµØ¯ÙŠØ±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

module.exports = {
    getAIResponse,
    clearMemory,
    getMemoryStats,
    KNOWLEDGE_BASE
};
